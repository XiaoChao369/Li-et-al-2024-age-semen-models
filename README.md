# Li-et-al-2024-age-semen-models

DNA methylation-based age estimation from semen: 
genome-wide marker identification and model development

Final models for age estimation from semen using semen-specific age-related
CpG markers

Accurate age estimation from semen has the potential to significantly narrow
down the pool of unidentified suspects in sexual assault investigations. In a
study, we trained models using methylation data from 154 CpG sites across 247 
semen DNA samples, ranging in age from 22 to 67 years. Here, we present five 
models: RF_model_9_CpG, RF_model_14_CpG, MLR_model_13_CpG, MLR_model_14_CpG, 
and RF_model_9_CpG_drrbs.

The following steps outline the functionality of these five models, which are 
designed to work with methylation data generated by massively parallel 
sequencing technologies, such as bisulfite amplicon sequencing.

## Download files
Before starting, download files required to run the five models:
```
# https://github.com/XiaoChao369/Li-et-al-2024-age-semen-models
```
## Set environment
```
options(stringsAsFactors = FALSE)
rm(list = ls())
```
## Set working directory
For convenience, set the directory containing the data or saving the results:
```
dirModel <- "J:/Li-et-al-2024-age-semen-models"  #  model files
dirData <- paste(dirModel, "/example_data", sep = "")  #  data tables
dirResult <- paste(dirModel, "/example_results", sep = "")  # for saving results
```

## RF_model_9_CpG model
The RF_model_9_CpG model is a random forest (RF) model, including 9 age-related
CpG (AR-CpG) sites, namely chr2:129071885 (cg19998819), chr12:4535197 (cg11262154),
chr10:4384066 (cg12277678), chr21:45509586 (cg04123357), chr13:32846238 (cg18037145),
chr16:65834073 (cg25187042), chr20:42179997 (cg20602007), chr12:123465627 (cg21843517),
and chrUn_GL000220v1:118890. This model can be used to estimate individual age
from semen or sperm DNA.

Prepare data:
```
# Input: a table in either a '.txt' (tab-separated file) or in a '.csv'
# (comma-separated) format. Ensure that the data is organized as specified below
# and includes at least the following columns: "Sample.Name", "Marker", and
# "Meth_level". The "Meth_level" represents DNA methylation levels generated by 
# massively parallel sequencing technologies, such as bisulfite amplicon sequencing. 
# The values should be expressed as percentages and fall within the range of 0 to 100.
# 
# An example in '.txt' (tab-separated file) format:
# 
# Sample.Name Marker  Meth_level  ...
# SN001 chr2.129071885  60.18492  ...
# SN001 chr12.4535197 73.74337  ...
# SN001 chr13.32846238  48.32148  ...
# SN001 chr21.45509586  68.60531  ...
# SN001 chr10.4384066 45.66817  ...
# SN001 chr16.65834073  49.76106  ...
# SN001 chr20.42179997  45.56237  ...
# SN001 chr12.123465627 51.33506  ...
# SN001 chrUn_GL000220v1.118890 14.97300  ...
#
# An example in '.csv' (comma-separated) format:
# 
# Sample.Name,Marker,Meth_level,...
# SN001,chr2.129071885,60.18492,...
# SN001,chr12.4535197,73.74337,...
# SN001,chr13.32846238,48.32148,...
# SN001,chr21.45509586,68.60531,...
# SN001,chr10.4384066,45.66817,...
# SN001,chr16.65834073,49.76106,...
# SN001,chr20.42179997,45.56237,...
# SN001,chr12.123465627,51.33506,...
# SN001,chrUn_GL000220v1.118890,14.97300,...
```
Run the RF_model_9_CpG model on your data using the "RF_model_9_CpG.R" script 
provided. The only thing you have to do is to copy the prepared data file into
the 'dirData' folder.
```
setwd(dirModel)
source('RF_model_9_CpG.R')
```
The output 'estimated_age' is in years and is automatically printed in the R
console but is also saved as a '.csv' file, which can be found in the 
'dirResult' folder.
```
print(estimated_age)

#   Sample.Name Estimated.Age
# 1       SN001      28.36799
```

## RF_model_14_CpG model
The RF_model_14_CpG model is a random forest (RF) model, including 14 age-related
CpG (AR-CpG) sites, namely chr2:129071885 (cg19998819), chr12:4535197 (cg11262154),
chr10:4384066 (cg12277678), chr21:45509586 (cg04123357), chr13:32846238 (cg18037145),
chr16:65834073 (cg25187042), chr20:42179997 (cg20602007), chr12:123465627 (cg21843517),
chrUn_GL000220v1:118890, chr8:54102463, chr8:114387390 (cg27231587), chr21:45509584,
chr19:18610689, and chr8:114387489. This model can be used to estimate individual age
from semen or sperm DNA.

Prepare data:
```
# Input: a table in either a '.txt' (tab-separated file) or in a '.csv'
# (comma-separated) format. Ensure that the data is organized as specified below
# and includes at least the following columns: "Sample.Name", "Marker", and
# "Meth_level". The "Meth_level" represents DNA methylation levels generated by 
# massively parallel sequencing technologies, such as bisulfite amplicon sequencing. 
# The values should be expressed as percentages and fall within the range of 0 to 100.
# 
# An example in '.txt' (tab-separated file) format:
# 
# Sample.Name	Marker	Meth_level  ...
# SN001	chr2.129071885	60.18492  ...
# SN001	chr13.32846238	48.32148  ...
# SN001	chr12.4535197	73.74337  ...
# SN001	chr10.4384066	45.66817  ...
# SN001	chr21.45509586	68.60531  ...
# SN001	chr16.65834073	49.76106  ...
# SN001	chr20.42179997	45.56237  ...
# SN001	chr12.123465627	51.33506  ...
# SN001	chrUn_GL000220v1.118890	14.97300  ...
# SN001	chr8.54102463	47.87679  ...
# SN001	chr8.114387489	30.40430  ...
# SN001	chr19.18610689	43.98734  ...
# SN001	chr21.45509584	95.53798  ...
# SN001	chr8.114387390	27.02864  ...
#
# An example in '.csv' (comma-separated) format:
# 
# Sample.Name,Marker,Meth_level,...
# SN001,chr2.129071885,60.18492,...
# SN001,chr13.32846238,48.32148,...
# SN001,chr12.4535197,73.74337,...
# SN001,chr10.4384066,45.66817,...
# SN001,chr21.45509586,68.60531,...
# SN001,chr16.65834073,49.76106,...
# SN001,chr20.42179997,45.56237,...
# SN001,chr12.123465627,51.33506,...
# SN001,chrUn_GL000220v1.118890,14.973,...
# SN001,chr8.54102463,47.87679,...
# SN001,chr8.114387489,30.4043,...
# SN001,chr19.18610689,43.98734,...
# SN001,chr21.45509584,95.53798,...
# SN001,chr8.114387390,27.02864,...
```

Run the RF_model_14_CpG model on your data using the "RF_model_14_CpG.R" script
provided. The only thing you have to do is to copy the prepared data file into
the 'dirData' folder.
```
setwd(dirModel)
source('RF_model_14_CpG.R')
```
The output 'estimated_age' is in years and is automatically printed in the R
console but is also saved as a '.csv' file, which can be found in the 
'dirResult' folder.
```
print(estimated_age)

#   Sample.Name Estimated.Age
# 1       SN001      28.18686
```

## MLR_model_13_CpG model
The MLR_model_13_CpG model is a multiple linear regression (MLR) model,
including 14 age-related CpG (AR-CpG) sites, namely chr2:129071885 (cg19998819),
chr10:4384066 (cg12277678), chr13:32846238 (cg18037145), chr21:45509586 (cg04123357),
chr16:65834073 (cg25187042), chr17:29574049 (cg13872326), chr13:93039685,
chr12:123465627 (cg21843517), chr12:4535197 (cg11262154), chr13:93039687,
chr1:19339503, chr11:89589683 (cg06979108), and chr8:54102463 (cg03030301-20).
This model can be used to estimate individual age from semen or sperm DNA.

Prepare data:
```
# Input: a table in either a '.txt' (tab-separated file) or in a '.csv'
# (comma-separated) format. Ensure that the data is organized as specified below
# and includes at least the following columns: "Sample.Name", "Marker", and
# "Meth_level". The "Meth_level" represents DNA methylation levels generated by 
# massively parallel sequencing technologies, such as bisulfite amplicon sequencing. 
# The values should be expressed as percentages and fall within the range of 0 to 100.
# 
# An example in '.txt' (tab-separated file) format:
# 
# Sample.Name	Marker	Meth_level  ...
# SN001	chr2.129071885	60.18492  ...
# SN001	chr10.4384066	45.66817  ...
# SN001	chr13.32846238	48.32148  ...
# SN001	chr21.45509586	68.60531  ...
# SN001	chr16.65834073	49.76106  ...
# SN001	chr17.29574049	78.81048  ...
# SN001	chr13.93039685	54.75997  ...
# SN001	chr12.123465627	51.33506  ...
# SN001	chr12.4535197	73.74337  ...
# SN001	chr13.93039687	52.21047  ...
# SN001	chr1.19339503	59.85325  ...
# SN001	chr11.89589683	62.36365  ...
# SN001	chr8.54102463	47.87679  ...
#
# An example in '.csv' (comma-separated) format:
# 
# Sample.Name,Marker,Meth_level,...
# SN001,chr2.129071885,60.18492,...
# SN001,chr10.4384066,45.66817,...
# SN001,chr13.32846238,48.32148,...
# SN001,chr21.45509586,68.60531,...
# SN001,chr16.65834073,49.76106,...
# SN001,chr17.29574049,78.81048,...
# SN001,chr13.93039685,54.75997,...
# SN001,chr12.123465627,51.33506,...
# SN001,chr12.4535197,73.74337,...
# SN001,chr13.93039687,52.21047,...
# SN001,chr1.19339503,59.85325,...
# SN001,chr11.89589683,62.36365,...
# SN001,chr8.54102463,47.87679,...
```

Run the MLR_model_13_CpG model on your data using the "MLR_model_13_CpG.R" script 
provided. The only thing you have to do is to copy the prepared data file into
the 'dirData' folder.
```
setwd(dirModel)
source('MLR_model_13_CpG.R')
```
The output 'estimated_age' is in years and is automatically printed in the R
console but is also saved as a '.csv' file, which can be found in the
'dirResult' folder.
```
print(estimated_age)

#  Sample.Name Estimated.Age
#        SN001      25.27936
```

## MLR_model_14_CpG model
The MLR_model_14_CpG model is a multiple linear regression (MLR) model,
including 14 age-related CpG (AR-CpG) sites, namely chr2:129071885 (cg19998819),
chr10:4384066 (cg12277678), chr13:32846238 (cg18037145), chr21:45509586 (cg04123357),
chr16:65834073 (cg25187042), chr17:29574049 (cg13872326), chr13:93039685,
chr12:123465627 (cg21843517), chr12:4535197 (cg11262154), chr13:93039687,
chr1:19339503, chr11:89589683 (cg06979108), chr8:54102463 (cg03030301-20),
and chr1:19339492. This model can be used to estimate individual age
from semen or sperm DNA.

Prepare data:
```
# Input: a table in either a '.txt' (tab-separated file) or in a '.csv'
# (comma-separated) format. Ensure that the data is organized as specified below
# and includes at least the following columns: "Sample.Name", "Marker", and
# "Meth_level". The "Meth_level" represents DNA methylation levels generated by 
# massively parallel sequencing technologies, such as bisulfite amplicon sequencing. 
# The values should be expressed as percentages and fall within the range of 0 to 100.
# 
# An example in '.txt' (tab-separated file) format:
# 
# Sample.Name	Marker	Meth_level  ...
# SN001	chr2.129071885	60.18492  ...
# SN001	chr10.4384066	45.66817  ...
# SN001	chr13.32846238	48.32148  ...
# SN001	chr21.45509586	68.60531  ...
# SN001	chr16.65834073	49.76106  ...
# SN001	chr17.29574049	78.81048  ...
# SN001	chr13.93039685	54.75997  ...
# SN001	chr12.123465627	51.33506  ...
# SN001	chr12.4535197	73.74337  ...
# SN001	chr13.93039687	52.21047  ...
# SN001	chr1.19339503	59.85325  ...
# SN001	chr11.89589683	62.36365  ...
# SN001	chr8.54102463	47.87679  ...
# SN001	chr1.19339492	52.74330  ...
#
# An example in '.csv' (comma-separated) format:
# 
# Sample.Name,Marker,Meth_level,...
# SN001,chr2.129071885,60.18492,...
# SN001,chr10.4384066,45.66817,...
# SN001,chr13.32846238,48.32148,...
# SN001,chr21.45509586,68.60531,...
# SN001,chr16.65834073,49.76106,...
# SN001,chr17.29574049,78.81048,...
# SN001,chr13.93039685,54.75997,...
# SN001,chr12.123465627,51.33506,...
# SN001,chr12.4535197,73.74337,...
# SN001,chr13.93039687,52.21047,...
# SN001,chr1.19339503,59.85325,...
# SN001,chr11.89589683,62.36365,...
# SN001,chr8.54102463,47.87679,...
# SN001,chr1.19339492,52.7433,...
```

Run the MLR_model_14_CpG model on your data using the "MLR_model_14_CpG.R" script 
provided. The only thing you have to do is to copy the prepared data file into
the 'dirData' folder.
```
setwd(dirModel)
source('MLR_model_14_CpG.R')
```
The output 'estimated_age' is in years and is automatically printed in the R
console but is also saved as a '.csv' file, which can be found in the
'dirResult' folder.
```
print(estimated_age)

#  Sample.Name Estimated.Age
#        SN001      25.60156
```

## RF_model_9_CpG_drrbs model
The RF_model_9_CpG_drrbs model is a random forest (RF) model, including 9 age-related
CpG (AR-CpG) sites identified by dRRBS, namely chr13:93039685, chr1:19339492,
chrUn_GL000220v1:118890, chr1:19339500, chr1:19339447, chr13:93039687,
chr16:54736316, chrUn_GL000220v1:118888, and chr1:19339432. This model can be
used to estimate individual age from semen or sperm DNA.

Prepare data:
```
# Input: a table in either a '.txt' (tab-separated file) or in a '.csv'
# (comma-separated) format. Ensure that the data is organized as specified below
# and includes at least the following columns: "Sample.Name", "Marker", and
# "Meth_level". The "Meth_level" represents DNA methylation levels generated by 
# massively parallel sequencing technologies, such as bisulfite amplicon sequencing. 
# The values should be expressed as percentages and fall within the range of 0 to 100.
# 
# An example in '.txt' (tab-separated file) format:
# 
# Sample.Name	Marker	Meth_level  ...
# SN001	chrUn_GL000220v1.118890	14.973  ...
# SN001	chr13.93039685	54.75997  ...
# SN001	chrUn_GL000220v1.118888	16.01179  ...
# SN001	chr1.19339492	52.7433  ...
# SN001	chr16.54736316	66.3298  ...
# SN001	chr1.19339500	58.30626  ...
# SN001	chr1.19339447	43.62603  ...
# SN001	chr13.93039687	52.21047  ...
# SN001	chr1.19339432	55.06322  ...
# 
# An example in '.csv' (comma-separated) format:
# 
# Sample.Name,Marker,Meth_level,...
# SN001,chrUn_GL000220v1.118890,14.973,...
# SN001,chr13.93039685,54.75997,...
# SN001,chrUn_GL000220v1.118888,16.01179,...
# SN001,chr1.19339492,52.7433,...
# SN001,chr16.54736316,66.3298,...
# SN001,chr1.19339500,58.30626,...
# SN001,chr1.19339447,43.62603,...
# SN001,chr13.93039687,52.21047,...
# SN001,chr1.19339432,55.06322,...
```

Run the RF_model_9_CpG_drrbs model on your data using the 
"RF_model_9_CpG_drrbs.R" script provided. The only thing you have to do is to 
copy the prepared data file into the 'dirData' folder.
```
setwd(dirModel)
source('RF_model_9_CpG_drrbs.R')
```
The output 'estimated_age' is in years and is automatically printed in the R
console but is also saved as a '.csv' file, which can be found in the
'dirResult' folder.
```
print(estimated_age)

#   Sample.Name Estimated.Age
#         SN001      29.78108
```


Contacts and bug reports
========================

Chao Xiao
xiaochao369@hust.edu.cn


Copyright and License Information
=================================

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
